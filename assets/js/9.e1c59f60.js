(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{422:function(e,o,s){"use strict";s.r(o);var i=s(62),a=Object(i.a)({},(function(){var e=this,o=e.$createElement,s=e._self._c||o;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"cookie和session"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cookie和session"}},[e._v("#")]),e._v(" Cookie和Session")]),e._v(" "),s("h2",{attrs:{id:"cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cookie"}},[e._v("#")]),e._v(" Cookie")]),e._v(" "),s("p",[e._v("Cookie 总是保存在客户端中，按在客户端中存储位置，Cookie可以分为内存 Cookie 和硬盘 Cookie。")]),e._v(" "),s("ul",[s("li",[e._v("内存 Cookie 由浏览器维护，保存在内存中，浏览器关闭时 Cookie 就会消失，其存在时间是短暂的。")]),e._v(" "),s("li",[e._v("硬盘 Cookie 保存在硬盘中，有一个过期时间，用户手动清理或者过期时间到，才会被清理；\n没有设置过期时间，默认情况下cookie是内存cookie，浏览器关闭时自动删除；有设置过期时间，并且过期时间不为0或负数的cookie，是硬盘cookie，需要手动或者到期时，才会删除；")])]),e._v(" "),s("h3",{attrs:{id:"生存周期"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生存周期"}},[e._v("#")]),e._v(" 生存周期")]),e._v(" "),s("ol",[s("li",[e._v("Expires 设置过期时间。设置格式是 ;expires=date-in-GMTString-format;")]),e._v(" "),s("li",[e._v("Max-Age 用来设置时间段，单位是秒，从浏览器收到报文开始计算。 ;max-age=max-age-in-seconds;")])]),e._v(" "),s("p",[e._v("若 Cookie 过期，则这个 Cookie 会被删除，并不会发送给服务端。")]),e._v(" "),s("h3",{attrs:{id:"作用域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#作用域"}},[e._v("#")]),e._v(" 作用域")]),e._v(" "),s("ul",[s("li",[e._v("Domain 指定哪些主机可以接受 cookie； 如果不指定，默认是 origin，不包括子域名。如果指定 Domain，则包含子域名。")]),e._v(" "),s("li",[e._v("path：指定主机下哪些路径可以接受 Cookie；设置 / ，所有路径都可以接受。")])]),e._v(" "),s("h3",{attrs:{id:"设置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置"}},[e._v("#")]),e._v(" 设置")]),e._v(" "),s("ul",[s("li",[e._v("客户端设置  document.cookie = 'name=leo;max-age=5'")]),e._v(" "),s("li",[e._v("服务端设置"),s("br"),e._v("\nctx.cookies.set('name', 'leo', {\nmaxAge: 5 * 1000\n})")])]),e._v(" "),s("p",[e._v("ctx.cookies.get('name')")]),e._v(" "),s("p",[e._v("请求头中会增加 Cookie: xxx")]),e._v(" "),s("h3",{attrs:{id:"安全性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安全性"}},[e._v("#")]),e._v(" 安全性")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("带上 Secure, 只能在 HTTPS 传输 Cookie。")])]),e._v(" "),s("li",[s("p",[e._v("HttpOnly，表示只能通过 HTTP 传输，不能通过 JS 访问， 这也是预防 XSS 的主要手段。")])]),e._v(" "),s("li",[s("p",[e._v("SameSite 可以预防 CSRF 攻击。")])])]),e._v(" "),s("ul",[s("li",[e._v("Strict 模式下，浏览器将完全的禁止第三方携带 Cookie。 只能够本域名下才能够携带 Cookie。")]),e._v(" "),s("li",[e._v("Lax 模式下，宽松一些，只能在 get 方法提交表单或者 a 标签发送 get 请求 的情况下携带 Cookie。")]),e._v(" "),s("li",[e._v("None 模式下，请求会自动携带上 Cookie。")])]),e._v(" "),s("h2",{attrs:{id:"session-依赖-cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#session-依赖-cookie"}},[e._v("#")]),e._v(" session (依赖 Cookie)")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("创建 session 的配置\nconst session = Session({\n// 原生 sess:keys   java中一般的话叫 sessionid\nkey: 'sessionid',\nmaxAge: 10 * 1000,\n// 签名，防止客户端修改伪造\nsigned: true\n}, app)\napp.use(session)")])]),e._v(" "),s("li",[s("p",[e._v("设置\nsession中存储用户信息\nctx.session.user = {id, name}")])]),e._v(" "),s("li",[s("p",[e._v("查看客户端\n在客户端 cookie 中会添加  sessionid，将 user 进行 base64编码")])])]),e._v(" "),s("p",[e._v("session 将这个值传递给客户端。 cookie 就会被携带过去。")]),e._v(" "),s("p",[e._v("服务器直接将这个值解码。")]),e._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[s("p",[e._v("获取\nctx.session.user  直接可以获取到  {id: xxx, name: xxx}")])]),e._v(" "),s("li",[s("p",[e._v("加密\n用户可以通过修改客户端的 cookie 中的数据， 可以通过session签名")])])]),e._v(" "),s("p",[e._v("signed: true")]),e._v(" "),s("p",[e._v("app.keys =  ['aaaa']  可以通过加盐，开加密出来")]),e._v(" "),s("p",[e._v("客户端的 cookie 中会新增一个 sessionid.sig 的加密值")]),e._v(" "),s("p",[e._v("如果用户修改之后，就拿不到用户信息了，也破解不了。")]),e._v(" "),s("p",[e._v("session 是基于 cookie 的。")]),e._v(" "),s("h2",{attrs:{id:"缺点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[e._v("#")]),e._v(" 缺点")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("容量上。 4kb")])]),e._v(" "),s("li",[s("p",[e._v("性能上。cookie 会被附加到每个 HTTP 请求中，所以无形中增加了流量。")])]),e._v(" "),s("li",[s("p",[e._v("安全缺陷。 cookie 是明文传输的")])]),e._v(" "),s("li",[s("p",[e._v("对于浏览器外的其他客户端（ios、Android）来说，必须手动的设置 Cookie 和 Session。不能够统一。 但是 token 是可以统一的。")])]),e._v(" "),s("li",[s("p",[e._v("对于服务器集群中如何可以保证其他系统可以正确的解析 session。 通过调配到别的服务器之后，如果能够知道这个 session 共享一个样子是比较麻烦的。")])])])])}),[],!1,null,null,null);o.default=a.exports}}]);