<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTP/3 | HTTP</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/http/assets/css/0.styles.a82bc65d.css" as="style"><link rel="preload" href="/http/assets/js/app.a9f7748e.js" as="script"><link rel="preload" href="/http/assets/js/2.fdc7410f.js" as="script"><link rel="preload" href="/http/assets/js/15.a5b6314d.js" as="script"><link rel="prefetch" href="/http/assets/js/10.175862a4.js"><link rel="prefetch" href="/http/assets/js/11.da069018.js"><link rel="prefetch" href="/http/assets/js/12.93495841.js"><link rel="prefetch" href="/http/assets/js/13.8448399c.js"><link rel="prefetch" href="/http/assets/js/14.19259a4b.js"><link rel="prefetch" href="/http/assets/js/16.f63eb92b.js"><link rel="prefetch" href="/http/assets/js/17.96dea844.js"><link rel="prefetch" href="/http/assets/js/18.23de83c2.js"><link rel="prefetch" href="/http/assets/js/19.3e2f9e36.js"><link rel="prefetch" href="/http/assets/js/20.ce055c61.js"><link rel="prefetch" href="/http/assets/js/21.9467c730.js"><link rel="prefetch" href="/http/assets/js/22.864cf96f.js"><link rel="prefetch" href="/http/assets/js/23.2ebd0b41.js"><link rel="prefetch" href="/http/assets/js/24.dc92fb3e.js"><link rel="prefetch" href="/http/assets/js/25.8a742a4a.js"><link rel="prefetch" href="/http/assets/js/26.7f50fc9d.js"><link rel="prefetch" href="/http/assets/js/27.1f4ad5a3.js"><link rel="prefetch" href="/http/assets/js/28.90b361f2.js"><link rel="prefetch" href="/http/assets/js/29.a5d3a86b.js"><link rel="prefetch" href="/http/assets/js/3.039192e6.js"><link rel="prefetch" href="/http/assets/js/4.bc7cf726.js"><link rel="prefetch" href="/http/assets/js/5.d250cb53.js"><link rel="prefetch" href="/http/assets/js/6.8779df89.js"><link rel="prefetch" href="/http/assets/js/7.ed1d2405.js"><link rel="prefetch" href="/http/assets/js/8.00f43ad9.js"><link rel="prefetch" href="/http/assets/js/9.e1c59f60.js">
    <link rel="stylesheet" href="/http/assets/css/0.styles.a82bc65d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/http/" class="home-link router-link-active"><!----> <span class="site-name">HTTP</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/http/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/l1872427108/uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.npmjs.com/package/uu-uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Npm
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/http/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/l1872427108/uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.npmjs.com/package/uu-uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Npm
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/http/componentDocs/HTTP报文结构.html" class="sidebar-link">HTTP 报文结构</a></li><li><a href="/http/componentDocs/HTTP请求方法.html" class="sidebar-link">HTTP 请求方法</a></li><li><a href="/http/componentDocs/URI.html" class="sidebar-link">如何理解 URI？</a></li><li><a href="/http/componentDocs/HTTP状态码.html" class="sidebar-link">HTTP 状态码</a></li><li><a href="/http/componentDocs/HTTP特点.html" class="sidebar-link">HTTP 的特点。</a></li><li><a href="/http/componentDocs/Accept.html" class="sidebar-link">Accept</a></li><li><a href="/http/componentDocs/HTTP 怎么传输定长和不定长的数据.html" class="sidebar-link">HTTP 怎么传输定长和不定长的数据</a></li><li><a href="/http/componentDocs/HTTP处理大文件的传输.html" class="sidebar-link">HTTP 处理大文件的传输</a></li><li><a href="/http/componentDocs/HTTP处理表单数据的提交.html" class="sidebar-link">HTTP 处理表单数据的提交</a></li><li><a href="/http/componentDocs/HTTP1.1如何解决队头堵塞.html" class="sidebar-link">HTTP解决队头堵塞</a></li><li><a href="/http/componentDocs/Cookie.html" class="sidebar-link">Cookie和Session</a></li><li><a href="/http/componentDocs/HTTP代理.html" class="sidebar-link">HTTP代理</a></li><li><a href="/http/componentDocs/代理缓存.html" class="sidebar-link">代理缓存</a></li><li><a href="/http/componentDocs/数据如何传输.html" class="sidebar-link">数据如何传输</a></li><li><a href="/http/componentDocs/HTTP1.html" class="sidebar-link">HTTP/1</a></li><li><a href="/http/componentDocs/HTTP1.1.html" class="sidebar-link">HTTP/1.1</a></li><li><a href="/http/componentDocs/HTTP:2.0.html" class="sidebar-link">HTTP/2</a></li><li><a href="/http/componentDocs/HTTP:3.html" aria-current="page" class="active sidebar-link">HTTP/3</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/http/componentDocs/HTTPS.html" class="sidebar-link">HTTPS</a></li><li><a href="/http/componentDocs/HTTPS让数据传输更安全.html" class="sidebar-link">HTTPS让数据传输更安全</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="http-3"><a href="#http-3" class="header-anchor">#</a> HTTP/3</h1> <p>HTTP/2 在 2018 年就开始得到了大规模的应用，HTTP/1 中存在的一大堆缺陷都得到了解决。</p> <p>多路复用技术能充分利用带宽，最大限度规避了 TCP 的慢启动所带来的问题，同时还实现了头部压缩、服务器推送等功能，使得页面资源的传输速度得到了大幅提升。</p> <p>不过 HTTP/2 依然存在一些缺陷，于是就有了 HTTP/3。</p> <h3 id="http-2缺陷-tcp队头阻塞"><a href="#http-2缺陷-tcp队头阻塞" class="header-anchor">#</a> HTTP/2缺陷---TCP队头阻塞</h3> <p>虽然 HTTP/2 解决了应用层面的队头阻塞问题, 不过和 HTTP/1.1 一样，HTTP/2 依然是基于 TCP 协议的，而 TCP 最初就是为了单连接而设计的。你可以把 TCP 连接看成是两台计算机之前的一个虚拟管道，计算机的一端将要传输的数据按照顺序放入管道，最终数据会以相同的顺序出现在管道的另外一头。</p> <p>HTTP/1.1 协议栈中 TCP 是如何传输数据的。为直观理解，你可以参考下图：</p> <p>从一端发送给另外一端的数据会被拆分为一个个按照顺序排列的数据包, 这些数据包通过网络传输到了接收端, 接收端再按照顺序将这些数据包组合成原始数据，这样就完成了数据传输。</p> <p>不过，如果在数据传输的过程中, 如果一个数据包因为网络故障或者其他原因丢包了，那么整个TCP的连接就会处于暂停状态，需要等待丢失的数据包被重新传输过来。</p> <p>你可以把 TCP 连接看成是一个按照顺序传输数据的管道，管道中的任意一个数据丢失了，那之后的数据都需要等待该数据的重新传输。为了直观理解，你可以参考下图：</p> <p>我们就把在 TCP 传输过程中，由于单个数据包的丢失而造成的阻塞称为 TCP 上的队头阻塞。</p> <p>那队头阻塞是怎么影响 HTTP/2 传输的呢？首先我们来看正常情况下 HTTP/2 是怎么传输多路请求的，为了直观理解，你可以参考下图：</p> <p>我们知道在 HTTP/2 中，多个请求是跑在一个 TCP 管道中的, 如果其中任意一路数据流中出现了丢包的情况，那么就会阻塞该TCP连接中的所有请求。不同于HTTP/1.1，使用 HTTP/1.1 时，浏览器为每个域名开启了 6 个 TCP 连接，如果其中的 1 个 TCP 连接发生了队头阻塞，那么其他的 5 个连接依然可以继续传输数据。</p> <p>所以，随着丢包率的增加，HTTP/2 的传输效率会越来越差，当系统达到了 2% 的丢包率时，HTTP/1.1 的传输效率反而比 HTTP/2 表现得更好。</p> <h3 id="http-2缺陷-tcp建立连接的延时"><a href="#http-2缺陷-tcp建立连接的延时" class="header-anchor">#</a> HTTP/2缺陷---TCP建立连接的延时</h3> <p>网络延迟又称 RTT。我们把从浏览器发送一个数据包到服务器，再从服务器返回数据包到浏览器的整个往返时间称为 RTT。</p> <p>HTTP/1 和 HTTP/2 都是使用 TCP 协议来传输的，而如果使用 HTTPS 的话，还需要使用 TLS 协议进行安全传输，而使用 TLS 也需要一个握手, 这就需要两个握手延迟过程。</p> <ol><li><p>在建立 TCP 连接的时候，需要和服务器进行三次握手来确认连接成功，也就是说需要在消耗完 1.5 个 RTT 之后才能进行数据传输。</p></li> <li><p>进行 TLS 连接，TLS 有两个版本——TLS1.2 和 TLS1.3，每个版本建立连接所花的时间不同，大致是需要 1～2 个 RTT。</p></li> <li><p>在传输数据之前，我们需要花掉 3～4 个 RTT。如果浏览器和服务器的物理距离较近，那么 1 个 RTT 的时间可能在 10 毫秒以内，也就是说总共要消耗掉 30～40 毫秒。但如果服务器相隔较远，那么 1 个 RTT 就可能需要 100 毫秒以上了，这种情况下整个握手过程需要 300～400 毫秒，这时用户就能明显地感受到“慢”了。</p></li></ol> <h3 id="tcp-协议僵化"><a href="#tcp-协议僵化" class="header-anchor">#</a> TCP 协议僵化</h3> <p>由于TCP队头阻塞和建立连接延迟等缺点。但是改变TCP协议来解决这些问题非常难。原因有两个:</p> <ol><li>第一个是中间设备的僵化。互联网是由多个网络互联的网状结构， 为了能够保障互联网的正常工作，我们需要在互联网的各处搭建各种设备，这些设备就被称为中间设备。</li></ol> <p>这些路由包括了路由器、防火墙、NAT、交换机等。通常依赖一些很少升级的软件，这些软件使用了大量的 TCP 特性，这些功能被设置之后就很少更新了。</p> <p>如果在客户端升级了 TCP 协议，但是当新协议的数据包经过这些中间设备时，它们可能不理解包的内容，于是这些数据就会被丢弃掉。这就是中间设备僵化，它是阻碍 TCP 更新的一大障碍。</p> <ol start="2"><li>除了中间设备僵化外，操作系统也是导致 TCP 协议僵化的另外一个原因。因为 TCP 协议都是通过操作系统内核来实现的，应用程序只能使用不能修改。通常操作系统的更新都滞后于软件的更新，因此要想自由地更新内核中的 TCP 协议也是非常困难的。</li></ol> <h3 id="quic-协议"><a href="#quic-协议" class="header-anchor">#</a> QUIC 协议</h3> <p>HTTP/2 存在一些比较严重的于TCP协议相关的缺陷，但由于TCP协议僵化，几乎不可能通过修改 TCP 协议自身来解决这些问题，解决问题的思路是绕过 TCP 协议，发明一个 TCP 和 UDP 之外的新的传输协议。</p> <p>但是这些中间设备，只认TCP和UDP，如果采用新的协议，这些设备同样不被很好的支持。</p> <p>HTTP/3 选择了一个折衷的方法----UDP协议，基于UDP实现类似于TCP的多路数据流、传输可靠性等功能，这套功能被称为 QUIC 协议。</p> <ul><li>实现了类似 TCP 的流量控制、传输可靠性的功能。虽然 UDP 不可以，但 QUIC 在 UDP 的基础上增加了一层来保证数据可靠性传输。它提供了数据包重传、拥塞控制以及其他一些TCP存在的特性。</li> <li>集成了 TLS 加密功能。 QUIC使用的是 TLS1.3，相比较早期版本 TLS1.3 有更多优点，其中最重要的一点是减少了握手所花费的 RTT 个数。</li> <li>实现了 HTTP/2 中多路复用功能。和TCP不同，QUIC实现了在同一物理连接上可以有多个独立的逻辑数据流。实现了数据流的单独传输, 就解决了 TCP 中队头阻塞的问题。</li> <li>实现了快速握手功能。由于 QUIC 是基于 UDP 的，所以 QUIC 可以实现使用 0-RTT 或者 1-RTT 来建立连接，这意味着 QUIC 可以用最快的速度来发送和接收数据，这样可以大大提升首次打开页面的速度。</li></ul> <h3 id="挑战"><a href="#挑战" class="header-anchor">#</a> 挑战</h3> <ol><li><p>服务器和服务器端都没有对 HTTP/3 提供比较完整的支持。Chrome 虽然在数年前就开始支持 Google 版本的 QUIC，但是这个版本的 QUIC 和官方的 QUIC 存在着非常大的差异。</p></li> <li><p>部署 HTTP/3 也存在着非常大的问题。因为系统内核对 UDP 的优化远远没有达到 TCP 的优化程度，这也是阻碍 QUIC 的一个重要原因。</p></li> <li><p>中间设备僵化的问题。这些设备对 UDP 的优化程度远远低于 TCP，据统计使用 QUIC 协议时，大约有 3%～7% 的丢包率。</p></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/http/componentDocs/HTTP:2.0.html" class="prev">
        HTTP/2
      </a></span> <span class="next"><a href="/http/componentDocs/HTTPS.html">
        HTTPS
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/http/assets/js/app.a9f7748e.js" defer></script><script src="/http/assets/js/2.fdc7410f.js" defer></script><script src="/http/assets/js/15.a5b6314d.js" defer></script>
  </body>
</html>
