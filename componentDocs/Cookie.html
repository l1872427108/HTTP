<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Cookie和Session | HTTP</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/http/assets/css/0.styles.a82bc65d.css" as="style"><link rel="preload" href="/http/assets/js/app.a9f7748e.js" as="script"><link rel="preload" href="/http/assets/js/2.fdc7410f.js" as="script"><link rel="preload" href="/http/assets/js/9.e1c59f60.js" as="script"><link rel="prefetch" href="/http/assets/js/10.175862a4.js"><link rel="prefetch" href="/http/assets/js/11.da069018.js"><link rel="prefetch" href="/http/assets/js/12.93495841.js"><link rel="prefetch" href="/http/assets/js/13.8448399c.js"><link rel="prefetch" href="/http/assets/js/14.19259a4b.js"><link rel="prefetch" href="/http/assets/js/15.a5b6314d.js"><link rel="prefetch" href="/http/assets/js/16.f63eb92b.js"><link rel="prefetch" href="/http/assets/js/17.96dea844.js"><link rel="prefetch" href="/http/assets/js/18.23de83c2.js"><link rel="prefetch" href="/http/assets/js/19.3e2f9e36.js"><link rel="prefetch" href="/http/assets/js/20.ce055c61.js"><link rel="prefetch" href="/http/assets/js/21.9467c730.js"><link rel="prefetch" href="/http/assets/js/22.864cf96f.js"><link rel="prefetch" href="/http/assets/js/23.2ebd0b41.js"><link rel="prefetch" href="/http/assets/js/24.dc92fb3e.js"><link rel="prefetch" href="/http/assets/js/25.8a742a4a.js"><link rel="prefetch" href="/http/assets/js/26.7f50fc9d.js"><link rel="prefetch" href="/http/assets/js/27.1f4ad5a3.js"><link rel="prefetch" href="/http/assets/js/28.90b361f2.js"><link rel="prefetch" href="/http/assets/js/29.a5d3a86b.js"><link rel="prefetch" href="/http/assets/js/3.039192e6.js"><link rel="prefetch" href="/http/assets/js/4.bc7cf726.js"><link rel="prefetch" href="/http/assets/js/5.d250cb53.js"><link rel="prefetch" href="/http/assets/js/6.8779df89.js"><link rel="prefetch" href="/http/assets/js/7.ed1d2405.js"><link rel="prefetch" href="/http/assets/js/8.00f43ad9.js">
    <link rel="stylesheet" href="/http/assets/css/0.styles.a82bc65d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/http/" class="home-link router-link-active"><!----> <span class="site-name">HTTP</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/http/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/l1872427108/uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.npmjs.com/package/uu-uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Npm
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/http/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/l1872427108/uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.npmjs.com/package/uu-uui" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Npm
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/http/componentDocs/HTTP报文结构.html" class="sidebar-link">HTTP 报文结构</a></li><li><a href="/http/componentDocs/HTTP请求方法.html" class="sidebar-link">HTTP 请求方法</a></li><li><a href="/http/componentDocs/URI.html" class="sidebar-link">如何理解 URI？</a></li><li><a href="/http/componentDocs/HTTP状态码.html" class="sidebar-link">HTTP 状态码</a></li><li><a href="/http/componentDocs/HTTP特点.html" class="sidebar-link">HTTP 的特点。</a></li><li><a href="/http/componentDocs/Accept.html" class="sidebar-link">Accept</a></li><li><a href="/http/componentDocs/HTTP 怎么传输定长和不定长的数据.html" class="sidebar-link">HTTP 怎么传输定长和不定长的数据</a></li><li><a href="/http/componentDocs/HTTP处理大文件的传输.html" class="sidebar-link">HTTP 处理大文件的传输</a></li><li><a href="/http/componentDocs/HTTP处理表单数据的提交.html" class="sidebar-link">HTTP 处理表单数据的提交</a></li><li><a href="/http/componentDocs/HTTP1.1如何解决队头堵塞.html" class="sidebar-link">HTTP解决队头堵塞</a></li><li><a href="/http/componentDocs/Cookie.html" aria-current="page" class="active sidebar-link">Cookie和Session</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/http/componentDocs/Cookie.html#cookie" class="sidebar-link">Cookie</a></li><li class="sidebar-sub-header"><a href="/http/componentDocs/Cookie.html#session-依赖-cookie" class="sidebar-link">session (依赖 Cookie)</a></li><li class="sidebar-sub-header"><a href="/http/componentDocs/Cookie.html#缺点" class="sidebar-link">缺点</a></li></ul></li><li><a href="/http/componentDocs/HTTP代理.html" class="sidebar-link">HTTP代理</a></li><li><a href="/http/componentDocs/代理缓存.html" class="sidebar-link">代理缓存</a></li><li><a href="/http/componentDocs/数据如何传输.html" class="sidebar-link">数据如何传输</a></li><li><a href="/http/componentDocs/HTTP1.html" class="sidebar-link">HTTP/1</a></li><li><a href="/http/componentDocs/HTTP1.1.html" class="sidebar-link">HTTP/1.1</a></li><li><a href="/http/componentDocs/HTTP:2.0.html" class="sidebar-link">HTTP/2</a></li><li><a href="/http/componentDocs/HTTP:3.html" class="sidebar-link">HTTP/3</a></li><li><a href="/http/componentDocs/HTTPS.html" class="sidebar-link">HTTPS</a></li><li><a href="/http/componentDocs/HTTPS让数据传输更安全.html" class="sidebar-link">HTTPS让数据传输更安全</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="cookie和session"><a href="#cookie和session" class="header-anchor">#</a> Cookie和Session</h1> <h2 id="cookie"><a href="#cookie" class="header-anchor">#</a> Cookie</h2> <p>Cookie 总是保存在客户端中，按在客户端中存储位置，Cookie可以分为内存 Cookie 和硬盘 Cookie。</p> <ul><li>内存 Cookie 由浏览器维护，保存在内存中，浏览器关闭时 Cookie 就会消失，其存在时间是短暂的。</li> <li>硬盘 Cookie 保存在硬盘中，有一个过期时间，用户手动清理或者过期时间到，才会被清理；
没有设置过期时间，默认情况下cookie是内存cookie，浏览器关闭时自动删除；有设置过期时间，并且过期时间不为0或负数的cookie，是硬盘cookie，需要手动或者到期时，才会删除；</li></ul> <h3 id="生存周期"><a href="#生存周期" class="header-anchor">#</a> 生存周期</h3> <ol><li>Expires 设置过期时间。设置格式是 ;expires=date-in-GMTString-format;</li> <li>Max-Age 用来设置时间段，单位是秒，从浏览器收到报文开始计算。 ;max-age=max-age-in-seconds;</li></ol> <p>若 Cookie 过期，则这个 Cookie 会被删除，并不会发送给服务端。</p> <h3 id="作用域"><a href="#作用域" class="header-anchor">#</a> 作用域</h3> <ul><li>Domain 指定哪些主机可以接受 cookie； 如果不指定，默认是 origin，不包括子域名。如果指定 Domain，则包含子域名。</li> <li>path：指定主机下哪些路径可以接受 Cookie；设置 / ，所有路径都可以接受。</li></ul> <h3 id="设置"><a href="#设置" class="header-anchor">#</a> 设置</h3> <ul><li>客户端设置  document.cookie = 'name=leo;max-age=5'</li> <li>服务端设置<br>
ctx.cookies.set('name', 'leo', {
maxAge: 5 * 1000
})</li></ul> <p>ctx.cookies.get('name')</p> <p>请求头中会增加 Cookie: xxx</p> <h3 id="安全性"><a href="#安全性" class="header-anchor">#</a> 安全性</h3> <ol><li><p>带上 Secure, 只能在 HTTPS 传输 Cookie。</p></li> <li><p>HttpOnly，表示只能通过 HTTP 传输，不能通过 JS 访问， 这也是预防 XSS 的主要手段。</p></li> <li><p>SameSite 可以预防 CSRF 攻击。</p></li></ol> <ul><li>Strict 模式下，浏览器将完全的禁止第三方携带 Cookie。 只能够本域名下才能够携带 Cookie。</li> <li>Lax 模式下，宽松一些，只能在 get 方法提交表单或者 a 标签发送 get 请求 的情况下携带 Cookie。</li> <li>None 模式下，请求会自动携带上 Cookie。</li></ul> <h2 id="session-依赖-cookie"><a href="#session-依赖-cookie" class="header-anchor">#</a> session (依赖 Cookie)</h2> <ol><li><p>创建 session 的配置
const session = Session({
// 原生 sess:keys   java中一般的话叫 sessionid
key: 'sessionid',
maxAge: 10 * 1000,
// 签名，防止客户端修改伪造
signed: true
}, app)
app.use(session)</p></li> <li><p>设置
session中存储用户信息
ctx.session.user = {id, name}</p></li> <li><p>查看客户端
在客户端 cookie 中会添加  sessionid，将 user 进行 base64编码</p></li></ol> <p>session 将这个值传递给客户端。 cookie 就会被携带过去。</p> <p>服务器直接将这个值解码。</p> <ol start="4"><li><p>获取
ctx.session.user  直接可以获取到  {id: xxx, name: xxx}</p></li> <li><p>加密
用户可以通过修改客户端的 cookie 中的数据， 可以通过session签名</p></li></ol> <p>signed: true</p> <p>app.keys =  ['aaaa']  可以通过加盐，开加密出来</p> <p>客户端的 cookie 中会新增一个 sessionid.sig 的加密值</p> <p>如果用户修改之后，就拿不到用户信息了，也破解不了。</p> <p>session 是基于 cookie 的。</p> <h2 id="缺点"><a href="#缺点" class="header-anchor">#</a> 缺点</h2> <ol><li><p>容量上。 4kb</p></li> <li><p>性能上。cookie 会被附加到每个 HTTP 请求中，所以无形中增加了流量。</p></li> <li><p>安全缺陷。 cookie 是明文传输的</p></li> <li><p>对于浏览器外的其他客户端（ios、Android）来说，必须手动的设置 Cookie 和 Session。不能够统一。 但是 token 是可以统一的。</p></li> <li><p>对于服务器集群中如何可以保证其他系统可以正确的解析 session。 通过调配到别的服务器之后，如果能够知道这个 session 共享一个样子是比较麻烦的。</p></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/http/componentDocs/HTTP1.1如何解决队头堵塞.html" class="prev">
        HTTP解决队头堵塞
      </a></span> <span class="next"><a href="/http/componentDocs/HTTP代理.html">
        HTTP代理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/http/assets/js/app.a9f7748e.js" defer></script><script src="/http/assets/js/2.fdc7410f.js" defer></script><script src="/http/assets/js/9.e1c59f60.js" defer></script>
  </body>
</html>
